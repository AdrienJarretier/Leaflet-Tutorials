<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Osrm Tests Requests</title>
    <link href='../json-formatter/JSONFormatter.css' media='all' rel='stylesheet' type='text/css'>
    <script src="../json-formatter/JSONFormatter.js"></script>
    <script src="../jquery-latest.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {

        $.ajax({
            type: "GET",
            dataType: "json",
            url: "conf.json",
            success: function(config, textStatus, jqXHR) {

                /**
                 * Make the request Url for osrm-routed (HTTP server)
                 *
                 * @param {object} osrmReq - the object with the parameters of the request, see the osrmReq object created below
                 *
                 * @returns {string} the url for the request ready to be sent.
                 */
                function makeUrl(osrmReq) {

                    var requestUrl = config.server + '/' + osrmReq.service + '/' + osrmReq.version + '/' + osrmReq.profile + '/';

                    for (var i = 0; i < osrmReq.coords.length; ++i) {

                        requestUrl += osrmReq.coords[i].lo + ',' + osrmReq.coords[i].la + ';';
                    }

                    // removing the last ';'
                    requestUrl = requestUrl.slice(0, -1);

                    // get the array of options keys
                    var optionsKeys = Object.keys(osrmReq.options);

                    if (optionsKeys.length > 0) {
                        requestUrl += '?';

                        for (var i = 0; i < optionsKeys.length; ++i) {

                            var key = optionsKeys[i];
                            requestUrl += key + '=' + osrmReq.options[key] + '&';
                        }

                        // removing the last '&'
                        requestUrl = requestUrl.slice(0, -1);
                    }

                    return requestUrl;
                }


                var osrmReq = {

                    // One of the following values: route, nearest, table, match, trip, tile
                    service: "route",

                    // Version of the protocol implemented by the service. v1 for all OSRM 5.x installations
                    version: "v1",

                    // Mode of transportation, is determined statically by the Lua profile that is used to prepare the data using osrm-extract. Typically car, bike or foot if using one of the supplied profiles.
                    profile: "car",


                    coords: [{
                        lo: 13.388860,
                        la: 52.517037,
                    }, {
                        lo: 13.385983,
                        la: 52.496891,
                    }],

                    /*
                        steps : Return route steps for each route leg
                    */
                    options: {
                        steps: true
                    }

                };

                console.log(osrmReq);

                var madeUrl = makeUrl(osrmReq);

                console.log(madeUrl);

                $("body").append("<p>OSRM HTTP request <br> <strong>" + madeUrl + "</strong></p>");
                $("body").append("<p>Response documentation : <a href='http://project-osrm.org/docs/v5.6.4/api/#responses'>Responses</a></p>");

                $.ajax({
                    type: "GET",
                    dataType: "json",
                    url: madeUrl,
                    success: function(data, textStatus, jqXHR) {

                        console.log(data);
                        JSONFormatter.format(data, {});

                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log("error : " + textStatus + errorThrown);
                    }
                });

            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.log("couldn't get the config file : " + textStatus + errorThrown);
            }
        });


    });
    </script>
</head>

<body>
    <h1>Osrm Tests Requests</h1>
    <p>Documentation for OSRM can be found on Github : <a href="https://github.com/Project-OSRM/osrm-backend/wiki">github.com/Project-OSRM</a></p>
    <p>And hosted on their site : <a href="http://project-osrm.org/docs/v5.6.4/api/#general-options">project-osrm.org/docs</a></p>
</body>

</html>